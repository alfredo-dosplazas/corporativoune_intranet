{% load humanize %}
{% load money %}
<c-layouts.app>
    <c-slot name="header">
        <div class="grid grid-cols-1 md:grid-cols-3 items-center gap-4">

            <!-- START -->
            <div class="justify-self-start">
                <h1 class="font-bold text-xl flex items-center gap-3">
                    {{ destajo.folio }}

                    {% if destajo.estado == "borrador" %}
                        <span class="badge badge-warning badge-sm">BORRADOR</span>
                    {% elif destajo.estado == "publicado" %}
                        <span class="badge badge-success badge-sm">PUBLICADO</span>
                    {% elif destajo.estado == "cancelado" %}
                        <span class="badge badge-error badge-sm">CANCELADO</span>
                    {% endif %}
                </h1>
            </div>

            <!-- MIDDLE -->
            <div class="justify-self-center text-sm opacity-70">
                {{ destajo.fecha }}
            </div>

            <!-- END -->
            <div class="justify-self-end flex gap-2">
                <a href="{% url 'destajos:update' destajo.pk %}"
                   class="btn btn-sm btn-outline">
                    Editar
                </a>
            </div>
        </div>
    </c-slot>

    <div class="space-y-6">

        <!-- ðŸ“Œ InformaciÃ³n general -->
        <div class="card bg-base-100 shadow border border-base-300">
            <div class="card-body grid md:grid-cols-2 gap-6 text-sm">

                <div class="space-y-2">
                    <div>
                        <span class="opacity-60">Fraccionamiento:</span>
                        <div class="font-semibold">
                            {{ destajo.agrupador }}
                        </div>
                    </div>

                    <div>
                        <span class="opacity-60">Contratista:</span>
                        <div class="font-semibold">
                            {{ destajo.contratista }}
                        </div>
                    </div>
                </div>

                <div class="space-y-2">
                    <div>
                        <span class="opacity-60">Solicitante:</span>
                        <div class="font-semibold">
                            {{ destajo.solicitante }}
                        </div>
                    </div>

                    <div>
                        <span class="opacity-60">Autoriza:</span>
                        <div class="font-semibold">
                            {{ destajo.autoriza }}
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- ðŸ“‹ Tabla de conceptos -->
        <div class="card bg-base-100 shadow border border-base-300">
            <div class="card-body p-0">

                <div class="overflow-x-auto">
                    <table class="table table-sm">
                        <thead class="bg-base-200 text-xs">
                        <tr>
                            <th>Trabajo</th>
                            <th class="text-right">Cantidad</th>
                            <th>Unidad</th>
                            <th class="text-right">Precio</th>
                            <th class="text-right">Subtotal</th>
                            <th class="text-right">Surtido</th>
                        </tr>
                        </thead>

                        <tbody>
                        {% for detalle in destajo.detalles.all %}
                            <tr>
                                <td class="font-medium">
                                    {{ detalle.trabajo.nombre }}
                                </td>

                                <td class="text-right">
                                    {{ detalle.cantidad|intcomma }}
                                </td>

                                <td>
                                    {{ detalle.get_unidad_display }}
                                </td>

                                <td class="text-right">
                                    {{ detalle.precio|money }}
                                </td>

                                <td class="text-right font-semibold">
                                    {{ detalle.subtotal|money }}
                                </td>

                                <td class="text-right">
                                    {{ detalle.surtido }}
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="6" class="text-center opacity-60 py-6">
                                    No hay conceptos agregados
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>

                        <!-- Totales -->
                        <tfoot class="bg-base-200">
                        <tr>
                            <td colspan="4" class="text-right font-semibold">
                                Total
                            </td>
                            <td class="text-right font-bold text-lg">
                                {{ destajo.total|default:0|money }}
                            </td>
                            <td></td>
                        </tr>
                        </tfoot>
                    </table>
                </div>

            </div>
        </div>

        <!-- ðŸ“ Observaciones -->
        {% if destajo.observaciones %}
            <div class="card bg-base-100 shadow border border-base-300">
                <div class="card-body">
                    <h3 class="font-semibold mb-2">Observaciones</h3>
                    <p class="text-sm whitespace-pre-line">
                        {{ destajo.observaciones }}
                    </p>
                </div>
            </div>
        {% endif %}

    </div>
</c-layouts.app>