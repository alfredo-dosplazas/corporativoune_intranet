{% load phone_filters %}
<div id="card_{{ contacto.pk }}"
     data-theme="{{ contacto.empresa.theme }}"
     class="relative card w-full bg-base-100 rounded-xl
            border border-base-300
            shadow-sm hover:shadow-lg transition
            print:shadow-none print:border-base-300
            {% if contacto.usuario and not contacto.usuario.is_active %}opacity-70 grayscale{% endif %}">

    <!-- Empresa accent line -->
    {% if contacto.empresa %}
        <div class="absolute top-0 inset-x-0 h-1
                bg-gradient-to-r
                from-[var(--color-primary-light)]
                via-primary
                to-[var(--color-primary-dark)]
                rounded-t-xl">
        </div>
    {% endif %}

    <div class="card-body p-5 flex flex-col min-h-[320px]">

        <div class="flex items-start gap-4 min-h-[80px]">

            <!-- FOTO -->
            <div class="avatar shrink-0">
                <div class="w-16 h-16 rounded-full ring ring-primary ring-offset-2 ring-offset-base-100">
                    {% if contacto.foto %}
                        <img src="{{ contacto.foto.url }}"
                             alt="{{ contacto.nombre_completo }}"
                             class="object-cover"/>
                    {% else %}
                        <div class="bg-primary text-primary-content flex items-center justify-center w-full h-full text-xl font-semibold">
                            {{ contacto.iniciales }}
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- INFO -->
            <div class="flex-1 min-w-0">

                <h2 class="text-lg font-semibold leading-tight truncate">
                    <a href="{% url 'directorio:detail' contacto.pk %}"
                       class="hover:text-primary transition">
                        {{ contacto.nombre_completo }}
                    </a>
                </h2>

                <p class="text-sm opacity-80 truncate">
                    {{ contacto.puesto.nombre|default:"Sin puesto" }}
                </p>

                <p class="text-xs opacity-60 truncate">
                    {{ contacto.area.nombre|default:"√Årea no asignada" }}
                </p>

                {% if contacto.usuario and not contacto.usuario.is_active %}
                    <span class="badge badge-sm mt-1">Inactivo</span>
                {% endif %}
            </div>

            <!-- LOGO EMPRESA -->
            {% if contacto.empresa and contacto.empresa.abreviatura %}
                <div class="hidden sm:flex shrink-0 items-center">
                    <c-component
                            is="apps.empresas.logos.{{ contacto.empresa.abreviatura }}"
                            class="h-10 w-auto text-primary opacity-80"
                    />
                </div>
            {% endif %}
        </div>

        <!-- DIVIDER -->
        <div class="divider my-1"></div>

        <div class="flex-1 flex flex-col justify-start gap-3 text-sm">

            {% if contacto.email_principal %}
                <div class="flex items-center justify-between group">

                    <div class="flex items-center gap-2 min-w-0">
                        <span class="icon-[material-symbols--mail-outline] text-primary"></span>
                        <a href="mailto:{{ contacto.email_principal.email }}"
                           class="truncate hover:underline">
                            {{ contacto.email_principal.email }}
                        </a>
                    </div>

                    <button
                            onclick="copyToClipboard('{{ contacto.email_principal.email }}')"
                            class="opacity-100 sm:opacity-0 sm:group-hover:opacity-100"
                            type="button"
                    >
                        <span class="icon-[mdi--content-copy]"></span>
                    </button>
                </div>
            {% endif %}


            {% for telefono in contacto.telefonos.all %}
                <div class="flex items-center justify-between group">

                    <div class="flex items-center gap-2">
                        <span class="icon-[material-symbols--call-outline] text-primary"></span>
                        <a href="tel:{{ telefono.telefono }}">
                            {{ telefono.telefono|phone_format }}
                        </a>
                    </div>

                    <div class="flex items-center gap-2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition">

                        <a href="tel:{{ telefono.telefono }}"
                           class="tooltip"
                           data-tip="Llamar">
                            <span class="icon-[mdi--phone] text-base-content/60 hover:text-primary"></span>
                        </a>

                        {% if telefono.es_celular %}
                            <a target="_blank"
                               href="https://api.whatsapp.com/send/?phone={{ telefono.telefono }}"
                               class="tooltip"
                               data-tip="WhatsApp">
                                <span class="icon-[logos--whatsapp-icon] text-green-500"></span>
                            </a>
                        {% endif %}

                        <button
                                onclick="copyToClipboard('{{ telefono.telefono }}')"
                                type="button"
                                class="tooltip"
                                data-tip="Copiar"
                        >
                            <span class="icon-[mdi--content-copy] text-base-content/50 hover:text-primary"></span>
                        </button>

                    </div>
                </div>
            {% endfor %}


        </div>

        <!-- FOOTER -->
        <div class="mt-auto pt-4 border-t border-base-200">

            <div class="flex items-center gap-2 print:hidden">

                <!-- Mobile icons -->
                <div class="flex sm:hidden gap-2">

                    <a href="{% url 'directorio:detail' contacto.pk %}"
                       class="btn btn-xs btn-ghost">
                        <span class="icon-[mdi--eye-outline]"></span>
                    </a>

                    {% if perms.directorio.change_contacto %}
                        <a href="{% url 'directorio:update' contacto.pk %}"
                           class="btn btn-xs btn-ghost text-info">
                            <span class="icon-[mdi--pencil-outline]"></span>
                        </a>
                    {% endif %}

                </div>

                <!-- Desktop buttons -->
                <div class="hidden sm:flex gap-2">

                    <a href="{% url 'directorio:detail' contacto.pk %}"
                       class="btn btn-xs">
                        Ver
                    </a>

                    {% if perms.directorio.change_contacto %}
                        <a href="{% url 'directorio:update' contacto.pk %}"
                           class="btn btn-xs btn-info">
                            Editar
                        </a>
                    {% endif %}

                </div>

                {% if contacto.slack_id %}
                    <a href="{{ contacto.slack_url }}"
                       class="btn btn-xs btn-outline btn-primary">
                        <span class="icon-[devicon--slack]"></span>
                    </a>
                {% endif %}

            </div>
        </div>

    </div>
</div>
